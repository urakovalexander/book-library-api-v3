# Book Library API

## Описание

Это REST API для мобильного приложения "Библиотека книг", разработанное на PHP 8.2 с использованием архитектурного паттерна MVC. API позволяет пользователям регистрироваться, авторизоваться, управлять своими книгами, предоставлять доступ к библиотекам другим пользователям и искать книги через внешний API.

## Требования

- **Язык программирования:** PHP 8.2
- **База данных:** MySQL 8
- **Веб-сервер:** Apache
- **Composer**

## Установка

### 1. Клонирование репозитория

https://github.com/urakovalexander/book-library-api-v3.git

### 2. Установка зависимостей

composer install

### 3. Настройка переменных окружения

DB_HOST=localhost
DB_DATABASE=library
DB_USERNAME=root
DB_PASSWORD=your_password

JWT_SECRET_KEY=your_secret_key_here
JWT_ISSUER=your_domain.com
JWT_AUDIENCE=your_domain.com
JWT_EXPIRATION_TIME=3600

	Замените your_password на пароль вашего пользователя базы данных.
	•	Замените your_secret_key_here на случайную строку (например, сгенерируйте UUID).
	•	Замените your_domain.com на ваш домен или localhost для локального использования.

 ### 4. Настройка веб-сервера
 
 	•	Укажите корневую директорию сайта на public/.
	•	Убедитесь, что модуль mod_rewrite включен.
	•	Проверьте, что файл .htaccess находится в директории public/.

 ### 5. Миграция базы данных

 Создайте базу данных с именем, указанным в DB_DATABASE.
  php database/migrate.php

### 6. Запуск сервера

Вы можете использовать встроенный сервер PHP для локального тестирования:
php -S localhost:8000 -t public
API будет доступен по адресу http://localhost:8000/

Использование

Тестирование API с помощью Postman

Инструкции по тестированию эндпоинтов с помощью Postman находятся в разделе “Тестирование эндпоинтов через Postman” выше.

Доступные эндпоинты

Авторизация и регистрация

	•	POST /register — регистрация нового пользователя.
	•	POST /login — авторизация пользователя.

Пользователи

	•	GET /users — получить список всех пользователей.
	•	POST /grant-access — предоставить доступ к своей библиотеке другому пользователю.

Книги

	•	GET /books — получить список своих книг.
	•	POST /books — создать новую книгу.
	•	GET /books/{id} — получить информацию о книге по ID.
	•	PUT /books/{id} — обновить книгу.
	•	DELETE /books/{id} — удалить книгу.
	•	POST /books/{id}/restore — восстановить удаленную книгу.

Библиотека другого пользователя

	•	GET /users/{id}/books — получить список книг другого пользователя (при наличии доступа).

Поиск и сохранение книг

	•	GET /search-books?q={search_term} — поиск книг через внешний API.
	•	POST /save-book — сохранить найденную книгу в свою библиотеку.

Безопасность

	•	Аутентификация: Используется JWT-аутентификация. Токен необходимо передавать в заголовке Authorization: Bearer {token}.
	•	SQL-инъекции: Используются подготовленные выражения для защиты от SQL-инъекций.
	•	XSS: Так как API возвращает данные в формате JSON, риск XSS минимален, но рекомендуется проверять и фильтровать данные при выводе на клиенте.

Форматирование кода

Для форматирования кода используется php-cs-fixer.

Запуск форматирования:
composer php-cs-fixer

Разработка

	•	Архитектура: MVC (Model-View-Controller)
	•	Сервисный слой: Бизнес-логика вынесена в сервисные классы.
	•	Роутинг: Используется nikic/fast-route для управления маршрутами.
	•	Аутентификация: Используется firebase/php-jwt для работы с JWT.
